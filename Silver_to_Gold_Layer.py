# Databricks notebook source
{"content":"IyBEYXRhYnJpY2tzIG5vdGVib29rIHNvdXJjZQojIE1BR0lDICVtZAojIE1BR0lDICNDcmVhdGUgR29sZCBUYWJsZXMKCiMgQ09NTUFORCAtLS0tLS0tLS0tCgojIE1BR0lDICVtZAojIE1BR0lDICMjQ3JlYXRlIExvbmdlc3QgYW5kIFNob3J0ZXN0IHJ1bndheXMgb2YgYWlycG9ydHMgR29sZCB0YWJsZQoKIyBDT01NQU5EIC0tLS0tLS0tLS0KCiNSZWFkIFNpbHZlciB0YWJsZXMKZGVmIHJlYWRfc2lsdmVyX2FpcnBvcnRzKCk6CiAgICByZXR1cm4gc3BhcmsucmVhZC50YWJsZSgic2lsdmVyX2FpcnBvcnRzIikKCmRlZiByZWFkX3NpbHZlcl9jb3VudHJpZXMoKToKICAgIHJldHVybiBzcGFyay5yZWFkLnRhYmxlKCJzaWx2ZXJfY291bnRyaWVzIikKCmRlZiByZWFkX3NpbHZlcl9ydW53YXlzKCk6CiAgICByZXR1cm4gc3BhcmsucmVhZC50YWJsZSgic2lsdmVyX3J1bndheXMiKQoKI0xvbmdlc3QgYW5kIFNob3J0ZXN0IFJ1bndheXMgb2YgZWFjaCBhaXJwb3J0IGluIGVhY2ggY291bnRyeQpkZWYgbG9uZ2VzdFNob3J0ZXN0UnVud2F5cyhzaWx2ZXJfYWlycG9ydHMpOgogICAgc3Bhcmsuc3FsKCIiIgogICAgICAgIENSRUFURSBPUiBSRVBMQUNFIFRBQkxFIGdvbGRfbG9uZ2VzdF9zaG9ydGVzdF9ydW53YXlzCiAgICAgICAgVVNJTkcgREVMVEEKICAgICAgICBQQVJUSVRJT05FRCBCWSAoY291bnRyeSkKICAgICAgICBBUwogICAgICAgICAgICBXSVRIIGxvbmdlc3RfcnVud2F5cyBBUyAoCiAgICAgICAgICAgICAgICBTRUxFQ1QgCiAgICAgICAgICAgICAgICAgICAgYWMuaWQgQVMgYWlycG9ydF9pZCwKICAgICAgICAgICAgICAgICAgICBhYy5uYW1lIEFTIGFpcnBvcnQsCiAgICAgICAgICAgICAgICAgICAgY28ubmFtZSBBUyBjb3VudHJ5LAogICAgICAgICAgICAgICAgICAgIHIubGVuZ3RoX2Z0IEFTIHJ1bndheV9sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgci53aWR0aF9mdCBBUyBydW53YXlfd2lkdGgKICAgICAgICAgICAgICAgIEZST00gc2lsdmVyX2FpcnBvcnRzIGFjCiAgICAgICAgICAgICAgICBJTk5FUiBKT0lOIHNpbHZlcl9ydW53YXlzIHIgT04gYWMuaWQgPSByLmFpcnBvcnRfcmVmCiAgICAgICAgICAgICAgICBJTk5FUiBKT0lOIHNpbHZlcl9jb3VudHJpZXMgY28gT04gYWMuaXNvX2NvdW50cnkgPSBjby5jb2RlCiAgICAgICAgICAgICAgICBXSEVSRSBhYy50eXBlIElOICgnc21hbGxfYWlycG9ydCcsICdtZWRpdW1fYWlycG9ydCcsICdsYXJnZV9haXJwb3J0JykKICAgICAgICAgICAgICAgIEFORCByLmxlbmd0aF9mdCA9IChTRUxFQ1QgTUFYKGxlbmd0aF9mdCkgRlJPTSBzaWx2ZXJfcnVud2F5cyBydSBXSEVSRSBydS5haXJwb3J0X3JlZiA9IGFjLmlkKQogICAgICAgICAgICApLAogICAgICAgICAgICBzaG9ydGVzdF9ydW53YXlzIEFTICgKICAgICAgICAgICAgICAgIFNFTEVDVCAKICAgICAgICAgICAgICAgICAgICBhYy5pZCBBUyBhaXJwb3J0X2lkLAogICAgICAgICAgICAgICAgICAgIHIubGVuZ3RoX2Z0IEFTIHJ1bndheV9sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgci53aWR0aF9mdCBBUyBydW53YXlfd2lkdGgKICAgICAgICAgICAgICAgIEZST00gc2lsdmVyX2FpcnBvcnRzIGFjCiAgICAgICAgICAgICAgICBJTk5FUiBKT0lOIHNpbHZlcl9ydW53YXlzIHIgT04gYWMuaWQgPSByLmFpcnBvcnRfcmVmCiAgICAgICAgICAgICAgICBXSEVSRSBhYy50eXBlIElOICgnc21hbGxfYWlycG9ydCcsICdtZWRpdW1fYWlycG9ydCcsICdsYXJnZV9haXJwb3J0JykKICAgICAgICAgICAgICAgIEFORCByLmxlbmd0aF9mdCA9IChTRUxFQ1QgTUlOKGxlbmd0aF9mdCkgRlJPTSBzaWx2ZXJfcnVud2F5cyByeSBXSEVSRSByeS5haXJwb3J0X3JlZiA9IGFjLmlkKQogICAgICAgICAgICApCiAgICAgICAgU0VMRUNUIAogICAgICAgICAgICBsci5jb3VudHJ5LAogICAgICAgICAgICBsci5haXJwb3J0LAogICAgICAgICAgICBsci5ydW53YXlfbGVuZ3RoIEFTIGxvbmdlc3RfcnVud2F5X2xlbmd0aCwKICAgICAgICAgICAgbHIucnVud2F5X3dpZHRoIEFTIGxvbmdlc3RfcnVud2F5X3dpZHRoLAogICAgICAgICAgICBzci5ydW53YXlfbGVuZ3RoIEFTIHNob3J0ZXN0X3J1bndheV9sZW5ndGgsCiAgICAgICAgICAgIHNyLnJ1bndheV93aWR0aCBBUyBzaG9ydGVzdF9ydW53YXlfd2lkdGgKICAgICAgICBGUk9NIGxvbmdlc3RfcnVud2F5cyBscgogICAgICAgIElOTkVSIEpPSU4gc2hvcnRlc3RfcnVud2F5cyBzciBPTiBsci5haXJwb3J0X2lkID0gc3IuYWlycG9ydF9pZAogICAgIiIiKQogICAgcHJpbnQoIkdvbGQgSW5nZXN0aW9uIGNvbXBsZXRlZCAtIERhdGEgVHJhbnNmb3JtZWQgYW5kIEluZ2VzdGVkIGludG8gZ29sZF9sb25nZXN0X3Nob3J0ZXN0X3J1bndheXMgdGFibGUiKQoKCiNTaWx2ZXIgdG8gR29sZCBJbmdlc3Rpb24Kc2lsdmVyX2FpcnBvcnRzID0gcmVhZF9zaWx2ZXJfYWlycG9ydHMoKQpsb25nZXN0U2hvcnRlc3RSdW53YXlzKHNpbHZlcl9haXJwb3J0cykKCiMgQ09NTUFORCAtLS0tLS0tLS0tCgojIE1BR0lDICVtZAojIE1BR0lDICMjQ3JlYXRlIFRvcCAzIGNvdW50cmllcyB3aXRoIGhpZ2hlc3QgY291bnQgb2YgYWlycG9ydHMgR29sZCB0YWJsZQoKIyBDT01NQU5EIC0tLS0tLS0tLS0KCiNSZWFkIFNpbHZlciB0YWJsZQpkZWYgcmVhZF9zaWx2ZXJfYWlycG9ydHMoKToKICAgIHJldHVybiBzcGFyay5yZWFkLnRhYmxlKCJzaWx2ZXJfYWlycG9ydHMiKQoKZGVmIHJlYWRfc2lsdmVyX2NvdW50cmllcygpOgogICAgcmV0dXJuIHNwYXJrLnJlYWQudGFibGUoInNpbHZlcl9jb3VudHJpZXMiKQoKI1RvcCAzIGNvdW50cmllcyB3aXRoIGhpZ2hlc3QgY291bnQgb2YgYWlycG9ydHMKZGVmIHRvcDNjb3VudHJpZXN3aXRoYWlycG9ydHMoc2lsdmVyX2FpcnBvcnRzLHNpbHZlcl9jb3VudHJpZXMpOgogICAgc3Bhcmsuc3FsKCIiIgogICAgICAgIENSRUFURSBPUiBSRVBMQUNFIFRBQkxFIHRvcDNfZ29sZF9jb3VudHJ5X2FpcnBvcnRfY291bnRzCiAgICAgICAgVVNJTkcgREVMVEEKICAgICAgICBTRUxFQ1QgCiAgICAgICAgY28ubmFtZSBhcyBDb3VudHJ5LAogICAgICAgIENPVU5UKGFpLmlzb19jb3VudHJ5KSBhcyBBaXJwb3J0c0NvdW50CiAgICAgICAgRlJPTSBzaWx2ZXJfYWlycG9ydHMgYWkKICAgICAgICBJTk5FUiBKT0lOIHNpbHZlcl9jb3VudHJpZXMgY28gT04gYWkuaXNvX2NvdW50cnkgPSBjby5jb2RlCiAgICAgICAgV0hFUkUgYWkudHlwZSBJTiAoJ3NtYWxsX2FpcnBvcnQnLCAnbWVkaXVtX2FpcnBvcnQnLCAnbGFyZ2VfYWlycG9ydCcpCiAgICAgICAgR1JPVVAgQlkgY28ubmFtZQogICAgICAgIE9SREVSIEJZIENPVU5UKGFpLmlzb19jb3VudHJ5KSBERVNDCiAgICAgICAgTElNSVQgMwogICAgIiIiKQogICAgcHJpbnQoIkdvbGQgSW5nZXN0aW9uIGNvbXBsZXRlZCAtIERhdGEgVHJhbnNmb3JtZWQgYW5kIEluZ2VzdGVkIGludG8gVG9wIDMgY291bnRyaWVzIHdpdGggaGlnaGVzdCBjb3VudCBvZiBhaXJwb3J0cyB0YWJsZSIpCgoKI1NpbHZlciB0byBHb2xkIEluZ2VzdGlvbgpzaWx2ZXJfYWlycG9ydHMgPSByZWFkX3NpbHZlcl9haXJwb3J0cygpCnNpbHZlcl9jb3VudHJpZXMgPSByZWFkX3NpbHZlcl9jb3VudHJpZXMoKQp0b3AzY291bnRyaWVzd2l0aGFpcnBvcnRzKHNpbHZlcl9haXJwb3J0cyxzaWx2ZXJfY291bnRyaWVzKQoKCiMgQ09NTUFORCAtLS0tLS0tLS0tCgojIE1BR0lDICVtZAojIE1BR0lDICMjQ3JlYXRlIEJvdHRvbSAxMCBjb3VudHJpZXMgd2l0aCBsb3dlc3QgY291bnQgb2YgYWlycG9ydHMgR29sZCB0YWJsZQoKIyBDT01NQU5EIC0tLS0tLS0tLS0KCiNSZWFkIFNpbHZlciB0YWJsZQpkZWYgcmVhZF9zaWx2ZXJfYWlycG9ydHMoKToKICAgIHJldHVybiBzcGFyay5yZWFkLnRhYmxlKCJzaWx2ZXJfYWlycG9ydHMiKQoKZGVmIHJlYWRfc2lsdmVyX2NvdW50cmllcygpOgogICAgcmV0dXJuIHNwYXJrLnJlYWQudGFibGUoInNpbHZlcl9jb3VudHJpZXMiKQoKI0JvdHRvbSAxMCBjb3VudHJpZXMgd2l0aCBoaWdoZXN0IGNvdW50IG9mIGFpcnBvcnRzCmRlZiBib3R0b20xMGNvdW50cmllc3dpdGhhaXJwb3J0cyhzaWx2ZXJfYWlycG9ydHMsc2lsdmVyX2NvdW50cmllcyk6CiAgICBzcGFyay5zcWwoIiIiCiAgICAgICAgQ1JFQVRFIE9SIFJFUExBQ0UgVEFCTEUgYm90dG9tMTBfZ29sZF9jb3VudHJ5X2FpcnBvcnRfY291bnRzCiAgICAgICAgVVNJTkcgREVMVEEKICAgICAgICBTRUxFQ1QgCiAgICAgICAgY28ubmFtZSBhcyBDb3VudHJ5LAogICAgICAgIENPVU5UKGFpLmlzb19jb3VudHJ5KSBhcyBBaXJwb3J0c0NvdW50CiAgICAgICAgRlJPTSBzaWx2ZXJfYWlycG9ydHMgYWkKICAgICAgICBJTk5FUiBKT0lOIHNpbHZlcl9jb3VudHJpZXMgY28gT04gYWkuaXNvX2NvdW50cnkgPSBjby5jb2RlCiAgICAgICAgV0hFUkUgYWkudHlwZSBJTiAoJ3NtYWxsX2FpcnBvcnQnLCAnbWVkaXVtX2FpcnBvcnQnLCAnbGFyZ2VfYWlycG9ydCcpCiAgICAgICAgR1JPVVAgQlkgY28ubmFtZQogICAgICAgIE9SREVSIEJZIENPVU5UKGFpLmlzb19jb3VudHJ5KSBBU0MKICAgICAgICBMSU1JVCAxMAogICAgIiIiKQogICAgcHJpbnQoIkdvbGQgSW5nZXN0aW9uIGNvbXBsZXRlZCAtIERhdGEgVHJhbnNmb3JtZWQgYW5kIEluZ2VzdGVkIGludG8gQm90dG9tIDEwIGNvdW50cmllcyB3aXRoIGhpZ2hlc3QgY291bnQgb2YgYWlycG9ydHMgdGFibGUiKQoKCiNTaWx2ZXIgdG8gR29sZCBJbmdlc3Rpb24Kc2lsdmVyX2FpcnBvcnRzID0gcmVhZF9zaWx2ZXJfYWlycG9ydHMoKQpzaWx2ZXJfY291bnRyaWVzID0gcmVhZF9zaWx2ZXJfY291bnRyaWVzKCkKZGZfYm90dG9tMTAgPSBib3R0b20xMGNvdW50cmllc3dpdGhhaXJwb3J0cyhzaWx2ZXJfYWlycG9ydHMsc2lsdmVyX2NvdW50cmllcykKcHJpbnQoZGZfYm90dG9tMTApCgojIENPTU1BTkQgLS0tLS0tLS0tLQoKIyBNQUdJQyAlbWQKIyBNQUdJQyAjI0NyZWF0ZSBhaXJwb3J0cyBHb2xkIHRhYmxlCgojIENPTU1BTkQgLS0tLS0tLS0tLQoKI1JlYWQgc2lsdmVyIHRhYmxlCmRlZiByZWFkX3NpbHZlcl9haXJwb3J0cygpOgogICAgcmV0dXJuIHNwYXJrLnJlYWQudGFibGUoInNpbHZlcl9haXJwb3J0cyIpCgojIFJlYWQgc2lsdmVyIGRhdGEgaW50byBkYXRhZnJhbWUgYW5kIHNhdmUgYXMgRGVsdGEgZ29sZCB0YWJsZQpkZWYgZ29sZF9haXJwb3J0c19pbmdlc3Rpb24oc2lsdmVyX2FpcnBvcnRzKToKICAgIGRmX2dvbGRfYWlycG9ydHMgPSBzaWx2ZXJfYWlycG9ydHMKICAgICMgU2F2ZSBhcyBEZWx0YSBHb2xkIHRhYmxlCiAgICBkZl9nb2xkX2FpcnBvcnRzLndyaXRlLmZvcm1hdCgiZGVsdGEiKS5tb2RlKCJvdmVyd3JpdGUiKS5zYXZlQXNUYWJsZSgiZ29sZF9haXJwb3J0cyIpCgogICAgcHJpbnQoIkdvbGQgSW5nZXN0aW9uIGNvbXBsZXRlZCAtIERhdGEgQ2xlYW5zZWQgYW5kIEluZ2VzdGVkIGludG8gZ29sZF9haXJwb3J0cyB0YWJsZSIpCiAgICAKCiNTaWx2ZXIgdG8gR29sZCBJbmdlc3Rpb24Kc2lsdmVyX2FpcnBvcnRzID0gcmVhZF9zaWx2ZXJfYWlycG9ydHMoKQpnb2xkX2FpcnBvcnRzX2luZ2VzdGlvbihzaWx2ZXJfYWlycG9ydHMpCgojIENPTU1BTkQgLS0tLS0tLS0tLQoKIyBNQUdJQyAlbWQKIyBNQUdJQyAjI0NyZWF0ZSBjb3VudHJpZXMgR29sZCB0YWJsZQoKIyBDT01NQU5EIC0tLS0tLS0tLS0KCiNSZWFkIHNpbHZlciB0YWJsZQpkZWYgcmVhZF9zaWx2ZXJfY291bnRyaWVzKCk6CiAgICByZXR1cm4gc3BhcmsucmVhZC50YWJsZSgic2lsdmVyX2NvdW50cmllcyIpCgojIFJlYWQgc2lsdmVyIGRhdGEgaW50byBkYXRhZnJhbWUgYW5kIHNhdmUgYXMgRGVsdGEgR29sZCB0YWJsZQpkZWYgZ29sZF9jb3VudHJpZXNfaW5nZXN0aW9uKHNpbHZlcl9jb3VudHJpZXMpOgogICAgZGZfZ29sZF9jb3VudHJpZXMgPSBzaWx2ZXJfY291bnRyaWVzCiAgICAjIFNhdmUgYXMgRGVsdGEgR29sZCB0YWJsZQogICAgZGZfZ29sZF9jb3VudHJpZXMud3JpdGUuZm9ybWF0KCJkZWx0YSIpLm1vZGUoIm92ZXJ3cml0ZSIpLnNhdmVBc1RhYmxlKCJnb2xkX2NvdW50cmllcyIpCgogICAgcHJpbnQoIkdvbGQgSW5nZXN0aW9uIGNvbXBsZXRlZCAtIERhdGEgQ2xlYW5zZWQgYW5kIEluZ2VzdGVkIGludG8gZ29sZF9jb3VudHJpZXMgdGFibGUiKQogICAgCgojU2lsdmVyIHRvIEdvbGQgSW5nZXN0aW9uCnNpbHZlcl9jb3VudHJpZXMgPSByZWFkX3NpbHZlcl9jb3VudHJpZXMoKQpnb2xkX2NvdW50cmllc19pbmdlc3Rpb24oc2lsdmVyX2NvdW50cmllcykKCiMgQ09NTUFORCAtLS0tLS0tLS0tCgojIE1BR0lDICVtZAojIE1BR0lDICMjQ3JlYXRlIHJ1bndheXMgR29sZCB0YWJsZQoKIyBDT01NQU5EIC0tLS0tLS0tLS0KCiNSZWFkIHNpbHZlciB0YWJsZQpkZWYgcmVhZF9zaWx2ZXJfcnVud2F5cygpOgogICAgcmV0dXJuIHNwYXJrLnJlYWQudGFibGUoInNpbHZlcl9ydW53YXlzIikKCiMgUmVhZCBzaWx2ZXIgZGF0YSBpbnRvIGRhdGFmcmFtZSBhbmQgc2F2ZSBhcyBEZWx0YSBHb2xkIHRhYmxlCmRlZiBnb2xkX3J1bndheXNfaW5nZXN0aW9uKHNpbHZlcl9ydW53YXlzKToKICAgIGRmX2dvbGRfcnVud2F5cyA9IHNpbHZlcl9ydW53YXlzCiAgICAjIFNhdmUgYXMgRGVsdGEgR29sZCB0YWJsZQogICAgZGZfZ29sZF9ydW53YXlzLndyaXRlLmZvcm1hdCgiZGVsdGEiKS5tb2RlKCJvdmVyd3JpdGUiKS5zYXZlQXNUYWJsZSgiZ29sZF9ydW53YXlzIikKCiAgICBwcmludCgiR29sZCBJbmdlc3Rpb24gY29tcGxldGVkIC0gRGF0YSBDbGVhbnNlZCBhbmQgSW5nZXN0ZWQgaW50byBnb2xkX3J1bndheXMgdGFibGUiKQogICAgCgojU2lsdmVyIHRvIEdvbGQgSW5nZXN0aW9uCnNpbHZlcl9ydW53YXlzID0gcmVhZF9zaWx2ZXJfcnVud2F5cygpCmdvbGRfcnVud2F5c19pbmdlc3Rpb24oc2lsdmVyX3J1bndheXMp","file_type":"py"}